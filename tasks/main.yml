---
# tasks file for ansible-ip

- name: Set transmission queue length
  shell: |
    IFS= read <<< $(ip link show {{ ip_link_name }})
    qlen=${REPLY##*qlen }
    if [ "$qlen" -ne {{ ip_link_txqueuelen }} ]
    then
      ip link set {{ ip_link_name }} txqueuelen {{ ip_link_txqueuelen }}
      printf 'changed\n'
    fi
  register: result
  changed_when: result.stdout == "changed"

- name: Ensure correct transmission queue length on reboot
  lineinfile:
    dest: /etc/rc.local
    regexp: ip link set {{ ip_link_name }} txqueuelen
    line: ip link set {{ ip_link_name }} txqueuelen {{ ip_link_txqueuelen }}

